<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Non-julian MCMC · Pigeons.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://Julia-Tempering.github.io/Pigeons.jl/input-nonjulian/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Pigeons.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Basic usage (local)</a></li><li><a class="tocitem" href="../unidentifiable-example/">Why PT?</a></li><li><a class="tocitem" href="../parallel/">Parallelization</a></li><li><a class="tocitem" href="../mpi/">Distributed usage (MPI)</a></li><li><a class="tocitem" href="../variational/">Variational PT</a></li><li><span class="tocitem">Supported inputs</span><ul><li><a class="tocitem" href="../input-overview/">Inputs overview</a></li><li><a class="tocitem" href="../input-turing/">Turing.jl model</a></li><li><a class="tocitem" href="../input-julia/">Black-box function</a></li><li><a class="tocitem" href="../input-stan/">Stan model</a></li><li class="is-active"><a class="tocitem" href>Non-julian MCMC</a><ul class="internal"><li><a class="tocitem" href="#Usage-example"><span>Usage example</span></a></li></ul></li><li><a class="tocitem" href="../input-explorers/">Custom MCMC</a></li></ul></li><li><span class="tocitem">Outputs</span><ul><li><a class="tocitem" href="../output-overview/">Outputs overview</a></li><li><a class="tocitem" href="../output-reports/">Quick reports</a></li><li><a class="tocitem" href="../output-plotting/">Plots</a></li><li><a class="tocitem" href="../output-normalization/">log(Z)</a></li><li><a class="tocitem" href="../output-numerical/">Numerical</a></li><li><a class="tocitem" href="../output-online/">Online stats</a></li><li><a class="tocitem" href="../output-off-memory/">Off-memory</a></li><li><a class="tocitem" href="../output-pt/">PT diagnostics</a></li><li><a class="tocitem" href="../output-custom-types/">Custom types</a></li><li><a class="tocitem" href="../output-extended/">Extended output</a></li><li><a class="tocitem" href="../output-mpi-postprocessing/">MPI output</a></li></ul></li><li><a class="tocitem" href="../checkpoints/">Checkpoints</a></li><li><a class="tocitem" href="../correctness/">Correctness checks</a></li><li><a class="tocitem" href="../pt/">More on PT</a></li><li><a class="tocitem" href="../distributed/">More on distributed PT</a></li><li><a class="tocitem" href="../interfaces/">Interfaces</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Supported inputs</a></li><li class="is-active"><a href>Non-julian MCMC</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Non-julian MCMC</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Julia-Tempering/Pigeons.jl/blob/main/docs/src/input-nonjulian.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="input-nonjulian"><a class="docs-heading-anchor" href="#input-nonjulian">Targeting a non-Julian model</a><a id="input-nonjulian-1"></a><a class="docs-heading-anchor-permalink" href="#input-nonjulian" title="Permalink"></a></h1><p>Suppose you have some code implementing vanilla MCMC, written in an arbitrary &quot;foreign&quot; language such as C++, Python, R, Java, etc. You would like to turn this vanilla MCMC code into a Parallel Tempering algorithm able to harness large numbers of cores, including distributing this algorithm over MPI. However, you do not wish to learn anything about MPI/multi-threading/Parallel Tempering.</p><p>Surprisingly, it is very simple to bridge such code with Pigeons. The only requirement on the &quot;foreign&quot; language is that it supports reading the standard in and writing to the standard out, hence virtually any languages can be interfaced in this fashion. Based on this minimalist &quot;standard stream bridge&quot; with worker processes running foreign code (one such process per replica; not necessarily running on the same machine), Pigeons will coordinate the execution of an adaptive non-reversible parallel tempering algorithm.</p><p>This behaviour is implemented in <a href="../reference/#Pigeons.StreamTarget"><code>StreamTarget</code></a>, see its documentation for details.  In a nutshell, there will be one child process for each PT chain. These processes will not necessarily be on  the same machine: indeed distributed sampling is the key use case of this bridge.  Pigeons will do some  lightweight coordination with these child processes to orchestrate non-reversible parallel tempering.  Interprocess communication only involves pigeons telling each child process  to perform exploration at a pigeons-provided annealing parameter. </p><p><a href="../reference/#Pigeons.StreamTarget"><code>StreamTarget</code></a> implements <a href="../interfaces/#Pigeons.log_potential"><code>log_potential</code></a> and <a href="../interfaces/#Pigeons.explorer"><code>explorer</code></a>  by invoking worker processes via standard stream communication. The standard stream is less efficient than alternatives such as  protobuff, but it has the advantage of being supported by nearly all  programming languages in existence.  Also in many practical cases, since the worker  process is invoked only three times per chain per iteration, it is unlikely to be the bottleneck (overhead is in the order of 0.1ms per interprocess call).  </p><h2 id="Usage-example"><a class="docs-heading-anchor" href="#Usage-example">Usage example</a><a id="Usage-example-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-example" title="Permalink"></a></h2><p>To demonstrate this capability, we show  here how it enables running Blang models in  pigeons.  <a href="https://github.com/UBC-Stat-ML/blangSDK">Blang</a> is a Bayesian modelling language designed  for sampling combinatorial spaces such as  phylogenetic trees. </p><p>We first setup Blang as follows (assuming Java 11 is accessible in the <code>PATH</code> variable):</p><pre><code class="language-julia hljs">using Pigeons

Pigeons.setup_blang(&quot;blangDemos&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Cloning into &#39;blangDemos&#39;...
Downloading https://services.gradle.org/distributions/gradle-5.2.1-bin.zip
...................................................................................

Welcome to Gradle 5.2.1!

Here are the highlights of this release:
 - Define sets of dependencies that work together with Java Platform plugin
 - New C++ plugins with dependency management built-in
 - New C++ project types for gradle init
 - Service injection into plugins and project extensions

For more details see https://docs.gradle.org/5.2.1/release-notes.html

Starting a Gradle Daemon (subsequent builds will be faster)
&gt; Task :generateXtext
WARNING:The use of wildcard imports is deprecated. (file:/home/runner/.pigeons/blangDemos/src/main/java/demos/PhylogeneticTree.bl line : 2 column : 1)

&gt; Task :compileJava
Note: Some input files use unchecked or unsafe operations.
Note: Recompile with -Xlint:unchecked for details.

&gt; Task :processResources
&gt; Task :classes
&gt; Task :jar
&gt; Task :startScripts
&gt; Task :installDist

BUILD SUCCESSFUL in 1m 5s
6 actionable tasks: 6 executed</code></pre><p>Next, we run a   <a href="https://github.com/UBC-Stat-ML/blangDemos/blob/master/src/main/java/demos/UnidentifiableProduct.bl">Blang implementation</a> of  our usual <a href="../unidentifiable-example/#unidentifiable-example">unidentifiable toy example</a>:</p><pre><code class="language-julia hljs">using Pigeons

blang_unidentifiable_example(n_trials, n_successes) =
    Pigeons.BlangTarget(
        `$(Pigeons.blang_executable(&quot;blangDemos&quot;, &quot;demos.UnidentifiableProduct&quot;)) --model.nTrials $n_trials --model.nFails $n_successes`
    )
pt = pigeons(target = blang_unidentifiable_example(100, 50))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Info: Neither traces, disk, nor online recorders included.
│    You may not have access to your samples (unless you are using a custom recorder, or maybe you just want log(Z)).
└    To add recorders, use e.g. pigeons(target = ..., record = [traces; record_default()])
Preprocess {
  2 samplers constructed with following prototypes:
    RealScalar sampled via: [RealSliceSampler]
} [ endingBlock=Preprocess blockTime=904.0ms blockNErrors=0 ]
Inference {
  ────────────────────────────────────────────────────────────────────────────
  scans        Λ        time(s)    allc(B)  log(Z₁/Z₀)   min(α)     mean(α)
────────── ────────── ────────── ────────── ────────── ────────── ──────────
        2      0.992      0.424   1.66e+07      -4.05      0.621       0.89
        4       1.42      0.139   6.41e+05      -4.43      0.192      0.842
        8       1.44      0.109   7.22e+05      -5.35      0.581       0.84
       16        1.7      0.147   1.44e+06      -4.72      0.577      0.811
       32       1.51      0.293   2.84e+06       -4.8      0.602      0.833
       64       1.52      0.581   5.56e+06      -4.95      0.727      0.831
      128       1.56      0.535   1.11e+07      -4.93      0.713      0.827
      256       1.52       1.13    2.2e+07      -5.06       0.78      0.831
      512       1.52       2.17   4.38e+07      -4.97      0.793      0.831
 1.02e+03       1.54       2.88   8.76e+07      -4.97      0.789      0.829
────────────────────────────────────────────────────────────────────────────</code></pre><p>As shown above, create a <a href="../reference/#Pigeons.StreamTarget"><code>StreamTarget</code></a> amounts to specifying which command will  be used to create a child process. </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../input-stan/">« Stan model</a><a class="docs-footer-nextpage" href="../input-explorers/">Custom MCMC »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 3 October 2023 17:03">Tuesday 3 October 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
