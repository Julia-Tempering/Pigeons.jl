<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Guide · Pigeons.jl</title><script data-outdated-warner src="assets/warner.js"></script><link rel="canonical" href="https://Julia-Tempering.github.io/Pigeons.jl/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>Pigeons.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Guide</a><ul class="internal"><li><a class="tocitem" href="#Goals"><span>Goals</span></a></li><li><a class="tocitem" href="#Example"><span>Example</span></a></li><li><a class="tocitem" href="#Specification-of-general-models"><span>Specification of general models</span></a></li><li><a class="tocitem" href="#Running-distributed-jobs"><span>Running distributed jobs</span></a></li></ul></li><li><a class="tocitem" href="pt/">Parallel Tempering (PT)</a></li><li><a class="tocitem" href="distributed/">Distributed PT</a></li><li><a class="tocitem" href=".interfaces/">Interfaces</a></li><li><a class="tocitem" href="reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Guide</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Julia-Tempering/Pigeons.jl/blob/main/docs/src/index.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Pigeons"><a class="docs-heading-anchor" href="#Pigeons">Pigeons</a><a id="Pigeons-1"></a><a class="docs-heading-anchor-permalink" href="#Pigeons" title="Permalink"></a></h1><p>Pigeons&#39; core algorithm is a distributed and parallel implementation  of the following algorithms: </p><ul><li>Non-Reversible Parallel Tempering (NRPT),    <a href="https://rss.onlinelibrary.wiley.com/doi/10.1111/rssb.12464">Syed et al., 2021</a>.</li><li>Variational PT, <a href="https://arxiv.org/abs/2206.00080">Surjanovic et al., 2022</a>.</li></ul><p>Pigeons can be used in a multi-threaded context, and/or  distributed over hundreds or thousands of MPI-communicating machines.</p><h2 id="Goals"><a class="docs-heading-anchor" href="#Goals">Goals</a><a id="Goals-1"></a><a class="docs-heading-anchor-permalink" href="#Goals" title="Permalink"></a></h2><p>We describe here the class of problems that can be approached using Pigeons.</p><p>Let <span>$\pi(x)$</span> denote a probability density called the <strong>target</strong>.  In many problems, e.g. in Bayesian statistics, the density <span>$\pi$</span> is typically  known only up to a normalization constant, </p><p class="math-container">\[\pi(x) = \frac{\gamma(x)}{Z},\]</p><p>where <span>$\gamma$</span> can be evaluated pointwise, but <span>$Z$</span> is unknown. Pigeons takes as input the function <span>$\gamma$</span>.</p><div class="admonition is-category-terminology"><header class="admonition-header">log_potential</header><div class="admonition-body"><p>Since we work in log-scale, we use the terminology  <code>log_potential</code> as a shorthand for the  unnormalized log density <span>$\log \gamma(x)$</span>.  See informal interface <a href=".interfaces/#Pigeons.log_potential"><code>log_potential</code></a>.</p></div></div><p>Pigeons&#39; outputs can be used for two tasks:</p><ul><li>Approximating expecations of the form <span>$E[f(X)]$</span>, where <span>$X \sim \pi$</span>.    For example, the choice <span>$f(x) = x$</span> computes the mean, and    <span>$f(x) = I[x \in A]$</span> computes the probability of <span>$A$</span> under <span>$\pi$</span>.</li><li>Approximating the value of the normalization constant <span>$Z$</span>. For    example, in Bayesian statistics, this corresponds to the    <a href="https://en.wikipedia.org/wiki/Marginal_likelihood">marginal likelihood</a>.</li></ul><p>Pigeons shines in the following scenarios:</p><ul><li>When the posterior density <span>$\pi$</span> is challenging due to    non-convexity and/or concentration on a    sub-manifolds due to unidentifiability.</li><li>When the user needs not only <span>$E[f(X)]$</span> but also <span>$Z$</span>. Many existing MCMC tools   focus on the former and struggle to do the latter in high dimensional    problems. </li><li>When the posterior density <span>$\pi$</span> is defined over a non-standard state-space,    e.g. a combinatorial object such as a phylogenetic tree. </li></ul><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><h3 id="Running-PT"><a class="docs-heading-anchor" href="#Running-PT">Running PT</a><a id="Running-PT-1"></a><a class="docs-heading-anchor-permalink" href="#Running-PT" title="Permalink"></a></h3><p>Specify the target distribution and, optionally,  parameters like random seed, etc by creating an  <a href="reference/#Pigeons.Inputs"><code>Inputs</code></a>:</p><pre><code class="language-julia hljs">using Pigeons

inputs = Inputs(target = toy_mvn_target(100))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Inputs{Pigeons.ScaledPrecisionNormalPath}(Pigeons.ScaledPrecisionNormalPath(1.0, 10.0, 100), 1, 10, 10, true, Function[], 0)</code></pre><p>See <a href="reference/#Pigeons.Inputs"><code>Inputs</code></a> for more options. </p><p>Then, run PT (locally on one process, but using multi-threading) using:</p><pre><code class="language-julia hljs">pt = pigeons(inputs)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PT(&quot;/home/runner/work/Pigeons.jl/Pigeons.jl/docs/build/results/all/2023-01-14-21-19-01-wC2kI55M&quot;)</code></pre><p>This runs PT on a 100-dimensional MVN toy example, and  returns a <a href="reference/#Pigeons.PT"><code>PT</code></a> struct containing the results of  this run (more later on how to access information inside  a PT struct).</p><p>Since the above two julia lines are the most common operation in this package, creating inputs and running PT can be done in one line as:</p><pre><code class="language-julia hljs">pt = pigeons(target = toy_mvn_target(100))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PT(&quot;/home/runner/work/Pigeons.jl/Pigeons.jl/docs/build/results/all/2023-01-14-21-19-06-j7iTjqAN&quot;)</code></pre><p>where the <code>args...</code> passed to <code>pigeons</code> are forwarded  to <a href="reference/#Pigeons.Inputs"><code>Inputs</code></a>.</p><h3 id="Loading-and-resuming-a-checkpoint"><a class="docs-heading-anchor" href="#Loading-and-resuming-a-checkpoint">Loading and resuming a checkpoint</a><a id="Loading-and-resuming-a-checkpoint-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-and-resuming-a-checkpoint" title="Permalink"></a></h3><p>By default, PT will automatically write a &quot;checkpoint&quot; periodically  to ensure that not more than half of the work is lost in  the event of e.g. a server failure.  See <a href="reference/#Pigeons.write_checkpoint-Tuple{Any, Any}"><code>write_checkpoint()</code></a> for details of how this  is accomplished in a way compatible to both the single-machine  and MPI contexts.  Each checkpoint is located in  <code>results/all/[unique folder]/round=[x]/checkpoint</code>,  with the latest run in <code>results/latest/[unique folder]/round=[x]/checkpoint</code>. </p><p>Checkpoints are also useful when an MPI-distributed PT has been  ran, and the user wants to load the full set of  results in one interactive session. </p><p>To load a checkpoint, create a <a href="reference/#Pigeons.PT"><code>PT</code></a> struct by passing in the path string to the checkpoint folder, for example to re-load the latest checkpoint  from the latest run:</p><pre><code class="language-julia hljs">pt = pigeons(target = toy_mvn_target(100))
pt_from_checkpoint = PT(&quot;results/latest&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PT(&quot;/home/runner/work/Pigeons.jl/Pigeons.jl/docs/build/results/all/2023-01-14-21-19-07-TxFtHJTv&quot;)</code></pre><p>Another use case is you may want to run more iterations  of an analysis done in the past. For example, to do two  extra rounds on the above PT algorithm run:</p><pre><code class="language-julia hljs">pt_from_checkpoint.inputs.n_rounds += 2
pigeons(pt_from_checkpoint)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PT(&quot;/home/runner/work/Pigeons.jl/Pigeons.jl/docs/build/results/all/2023-01-14-21-19-07-TxFtHJTv&quot;)</code></pre><p>You can also disable checkpoints when you create the  <a href="reference/#Pigeons.Inputs"><code>Inputs</code></a> struct or when passing the input  options directly into <a href="reference/#Pigeons.pigeons-Tuple{}"><code>pigeons()</code></a></p><pre><code class="nohighlight hljs">pigeons(target = toy_mvn_target(100), checkpoint = false);</code></pre><h3 id="Automatic-correctness-checks-for-parallel/distributed-implementations"><a class="docs-heading-anchor" href="#Automatic-correctness-checks-for-parallel/distributed-implementations">Automatic correctness checks for parallel/distributed implementations</a><a id="Automatic-correctness-checks-for-parallel/distributed-implementations-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-correctness-checks-for-parallel/distributed-implementations" title="Permalink"></a></h3><div class="admonition is-warning"><header class="admonition-header">TODO</header><div class="admonition-body"><p>Work in progress: show an example.</p></div></div><h2 id="Specification-of-general-models"><a class="docs-heading-anchor" href="#Specification-of-general-models">Specification of general models</a><a id="Specification-of-general-models-1"></a><a class="docs-heading-anchor-permalink" href="#Specification-of-general-models" title="Permalink"></a></h2><p>The most general way to invoke Pigeons is by specifying two ingredients: a sequence of distributions,  <span>$\pi_1, \pi_2, \dots, \pi_N$</span>, and for each <span>$\pi_i$</span>, a <span>$\pi_i$</span>-invariant Markov transition kernel. Typically, <span>$\pi_1$</span> is a distribution from which we can sample i.i.d. (e.g. the prior, or a variational  approximation), while the last distribution coincides with the distribution of interest,  <span>$\pi_N = \pi$</span>.  This sequence of distributions is specified using the informal interface <a href=".interfaces/#Pigeons.log_potentials"><code>log_potentials</code></a>. </p><div class="admonition is-warning"><header class="admonition-header">TODO</header><div class="admonition-body"><p>Add instructions for Markov transition kernels, and example code.</p></div></div><h2 id="Running-distributed-jobs"><a class="docs-heading-anchor" href="#Running-distributed-jobs">Running distributed jobs</a><a id="Running-distributed-jobs-1"></a><a class="docs-heading-anchor-permalink" href="#Running-distributed-jobs" title="Permalink"></a></h2><div class="admonition is-warning"><header class="admonition-header">TODO</header><div class="admonition-body"><p>Add instructions once the interface improves a bit.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="pt/">Parallel Tempering (PT) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Saturday 14 January 2023 21:19">Saturday 14 January 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
