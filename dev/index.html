<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Guide · Pigeons.jl</title><script data-outdated-warner src="assets/warner.js"></script><link rel="canonical" href="https://Julia-Tempering.github.io/Pigeons.jl/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>Pigeons.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Guide</a><ul class="internal"><li><a class="tocitem" href="#Scope"><span>Scope</span></a></li><li><a class="tocitem" href="#Installing-Pigeons"><span>Installing <code>Pigeons</code></span></a></li><li><a class="tocitem" href="#Running-PT"><span>Running PT</span></a></li><li><a class="tocitem" href="#Loading-and-resuming-a-checkpoint"><span>Loading and resuming a checkpoint</span></a></li><li><a class="tocitem" href="#Automatic-correctness-checks"><span>Automatic correctness checks</span></a></li><li><a class="tocitem" href="#Running-MPI-locally"><span>Running MPI locally</span></a></li><li><a class="tocitem" href="#Running-MPI-on-a-cluster"><span>Running MPI on a cluster</span></a></li><li><a class="tocitem" href="#Specification-of-general-models"><span>Specification of general models</span></a></li></ul></li><li><a class="tocitem" href="pt/">Parallel Tempering (PT)</a></li><li><a class="tocitem" href="distributed/">Distributed PT</a></li><li><a class="tocitem" href="interfaces/">Interfaces</a></li><li><a class="tocitem" href="reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Guide</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Julia-Tempering/Pigeons.jl/blob/main/docs/src/index.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Pigeons"><a class="docs-heading-anchor" href="#Pigeons">Pigeons</a><a id="Pigeons-1"></a><a class="docs-heading-anchor-permalink" href="#Pigeons" title="Permalink"></a></h1><p>Facing a challenging integration problem? Tired of waiting for hours or days for your high-dimensional, multimodal Bayesian posterior approximation? Summing over your combinatorial space is taking months? </p><p>Try <code>Pigeons</code>: a Julia package to efficiently approximate posterior distributions, and more broadly, Lebesgue integration problems. </p><p>Pigeons&#39; core algorithm is a distributed and parallel implementation  of the following algorithms: </p><ul><li>Non-Reversible Parallel Tempering (NRPT),    <a href="https://rss.onlinelibrary.wiley.com/doi/10.1111/rssb.12464">Syed et al., 2021</a>.</li><li>Variational PT, <a href="https://arxiv.org/abs/2206.00080">Surjanovic et al., 2022</a>. [under construction]</li></ul><p>These algorithms achieve state-of-the-art performance for approximation  of challenging probability distributions.</p><p>Pigeons can be used in a multi-threaded context, and/or  distributed over hundreds or thousands of MPI-communicating machines.</p><p>Distributed Parallel Tempering has some remarkable properties.  First, even if your model is very large, the network communication between  processes in the inner loop of the algorithm </p><h2 id="Scope"><a class="docs-heading-anchor" href="#Scope">Scope</a><a id="Scope-1"></a><a class="docs-heading-anchor-permalink" href="#Scope" title="Permalink"></a></h2><p>We describe here the class of problems that can be approached using Pigeons.</p><p>Let <span>$\pi(x)$</span> denote a probability density called the <strong>target</strong>.  In many problems, e.g. in Bayesian statistics, the density <span>$\pi$</span> is typically  known only up to a normalization constant, </p><p class="math-container">\[\pi(x) = \frac{\gamma(x)}{Z},\]</p><p>where <span>$\gamma$</span> can be evaluated pointwise, but <span>$Z$</span> is unknown. Pigeons takes as input the function <span>$\gamma$</span>.</p><div class="admonition is-category-terminology"><header class="admonition-header">log_potential</header><div class="admonition-body"><p>Since we work in log-scale, we use the terminology  <code>log_potential</code> as a shorthand for the  unnormalized log density <span>$\log \gamma(x)$</span>.  See informal interface <a href="interfaces/#Pigeons.log_potential"><code>log_potential</code></a>.</p></div></div><p>Pigeons&#39; outputs can be used for two tasks:</p><ul><li>Approximating expecations of the form <span>$E[f(X)]$</span>, where <span>$X \sim \pi$</span>.    For example, the choice <span>$f(x) = x$</span> computes the mean, and    <span>$f(x) = I[x \in A]$</span> computes the probability of <span>$A$</span> under <span>$\pi$</span>.</li><li>Approximating the value of the normalization constant <span>$Z$</span>. For    example, in Bayesian statistics, this corresponds to the    <a href="https://en.wikipedia.org/wiki/Marginal_likelihood">marginal likelihood</a>.</li></ul><p>Pigeons shines in the following scenarios:</p><ul><li>When the posterior density <span>$\pi$</span> is challenging due to    non-convexity and/or concentration on a    sub-manifolds due to unidentifiability.</li><li>When the user needs not only <span>$E[f(X)]$</span> but also <span>$Z$</span>. Many existing MCMC tools   focus on the former and struggle to do the latter in high dimensional    problems. </li><li>When the posterior density <span>$\pi$</span> is defined over a non-standard state-space,    e.g. a combinatorial object such as a phylogenetic tree. </li></ul><h2 id="Installing-Pigeons"><a class="docs-heading-anchor" href="#Installing-Pigeons">Installing <code>Pigeons</code></a><a id="Installing-Pigeons-1"></a><a class="docs-heading-anchor-permalink" href="#Installing-Pigeons" title="Permalink"></a></h2><ol><li>If you have not done so, install <a href="https://julialang.org/downloads/">Julia</a>. So far, we have tested the code on Julia 1.8.x.</li><li>Install <code>Pigeons</code> using</li></ol><pre><code class="nohighlight hljs">using Pkg; Pkg.add(url = &quot;https://github.com/Julia-Tempering/Pigeons.jl&quot;)</code></pre><h2 id="Running-PT"><a class="docs-heading-anchor" href="#Running-PT">Running PT</a><a id="Running-PT-1"></a><a class="docs-heading-anchor-permalink" href="#Running-PT" title="Permalink"></a></h2><p>Specify the target distribution and, optionally,  parameters like random seed, etc by creating an  <a href="reference/#Pigeons.Inputs"><code>Inputs</code></a>:</p><pre><code class="language-julia hljs">using Pigeons

inputs = Inputs(target = toy_mvn_target(100))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Inputs{Pigeons.ScaledPrecisionNormalPath}(Pigeons.ScaledPrecisionNormalPath(1.0, 10.0, 100), 1, 10, 10, true, Function[], 0)</code></pre><p>See <a href="reference/#Pigeons.Inputs"><code>Inputs</code></a> for more options. </p><p>Then, run PT (locally on one process, but using multi-threading) using the function <a href="reference/#Pigeons.pigeons-Tuple{}"><code>pigeons()</code></a>:</p><pre><code class="language-julia hljs">pt = pigeons(inputs)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PT(&quot;/home/runner/work/Pigeons.jl/Pigeons.jl/docs/build/results/all/2023-01-15-03-51-35-en5fD7BM&quot;)</code></pre><p>This runs PT on a 100-dimensional MVN toy example, and  returns a <a href="reference/#Pigeons.PT"><code>PT</code></a> struct containing the results of  this run (more later on how to access information inside  a PT struct).</p><p>Since the above two julia lines are the most common operation in this package, creating inputs and running PT can be done in one line as:</p><pre><code class="language-julia hljs">pt = pigeons(target = toy_mvn_target(100))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PT(&quot;/home/runner/work/Pigeons.jl/Pigeons.jl/docs/build/results/all/2023-01-15-03-51-39-CmfTpj2D&quot;)</code></pre><p>where the <code>args...</code> passed to <code>pigeons</code> are forwarded  to <a href="reference/#Pigeons.Inputs"><code>Inputs</code></a>.</p><h2 id="Loading-and-resuming-a-checkpoint"><a class="docs-heading-anchor" href="#Loading-and-resuming-a-checkpoint">Loading and resuming a checkpoint</a><a id="Loading-and-resuming-a-checkpoint-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-and-resuming-a-checkpoint" title="Permalink"></a></h2><p>By default, PT will automatically write a &quot;checkpoint&quot; periodically  to ensure that not more than half of the work is lost in  the event of e.g. a server failure.  See <a href="reference/#Pigeons.write_checkpoint-Tuple{Any, Any}"><code>write_checkpoint()</code></a> for details of how this  is accomplished in a way compatible to both the single-machine  and MPI contexts.  Each checkpoint is located in  <code>results/all/[unique folder]/round=[x]/checkpoint</code>,  with the latest run in <code>results/latest/[unique folder]/round=[x]/checkpoint</code>. </p><p>Checkpoints are also useful when an MPI-distributed PT has been  ran, and the user wants to load the full set of  results in one interactive session. </p><p>To load a checkpoint, create a <a href="reference/#Pigeons.PT"><code>PT</code></a> struct by passing in the path  string to the checkpoint folder, for example to re-load the latest checkpoint  from the latest run:</p><pre><code class="language-julia hljs">pt = pigeons(target = toy_mvn_target(100))
pt_from_checkpoint = PT(&quot;results/latest&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PT(&quot;/home/runner/work/Pigeons.jl/Pigeons.jl/docs/build/results/all/2023-01-15-03-51-40-DzQhEiEg&quot;)</code></pre><p>Another use case is you may want to run more iterations  of an analysis done in the past. For example, to do two  extra <em>rounds</em> on the above PT algorithm run  (a round is an iteration in the  outer loop of our adaptive PT algorithm, see <a href="pt.html">Parallel Tempering (PT)</a> for  more details):</p><pre><code class="language-julia hljs">pt_from_checkpoint.inputs.n_rounds += 2
pigeons(pt_from_checkpoint)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PT(&quot;/home/runner/work/Pigeons.jl/Pigeons.jl/docs/build/results/all/2023-01-15-03-51-40-DzQhEiEg&quot;)</code></pre><p>You can also disable checkpoints when you create the  <a href="reference/#Pigeons.Inputs"><code>Inputs</code></a> struct or when passing the input  options directly into <a href="reference/#Pigeons.pigeons-Tuple{}"><code>pigeons()</code></a></p><pre><code class="language-julia hljs">pigeons(target = toy_mvn_target(100), checkpoint = false);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PT(Inputs{Pigeons.ScaledPrecisionNormalPath}(Pigeons.ScaledPrecisionNormalPath(1.0, 10.0, 100), 1, 10, 10, false, Function[], 0), Pigeons.Replica{Vector{Float64}, NamedTuple{(:swap_acceptance_pr,), Tuple{OnlineStatsBase.GroupBy{Tuple{Int64, Int64}, Number, OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}}}}}[Pigeons.Replica{Vector{Float64}, NamedTuple{(:swap_acceptance_pr,), Tuple{OnlineStatsBase.GroupBy{Tuple{Int64, Int64}, Number, OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}}}}}([-1.2711738782848507, -0.1537412114278634, -0.3429739283430171, 0.5450419123433687, 0.30464622684252773, -1.9299347726798886, -0.4444897476356188, -1.038332005652887, -0.5997579971804404, -0.8810354104852353, 0.1858635490947705, -0.45309711135938346, -0.1883744725988766, -1.105080599549338, -2.21724619991344, -0.7484305706118735, -0.990004988409325, -0.7649642633856077, -0.10803466800643653, -0.7751136735712222, -1.5571589737650717, 0.6665771181675854, -0.9206580626696015, -0.4074529612714414, 0.6766698269425784, 0.47816755642440595, 1.9413083601378949, -0.8683797342069729, -2.2728653700697996, -0.8335213926771212, 1.1766035043141174, -0.8290418928240537, -1.017757484565226, 0.30085991580889826, -0.43310168789279907, 1.0584355184381904, -0.1898198937459001, -0.7479954457397069, 1.1991399903284055, -1.2763649279508875, -0.6927574954275424, 0.8260230991795636, -0.9844934604683763, -0.27538578464444896, 0.22165952470028943, -0.5559214848852371, 1.1099407693443226, 1.044961146155072, 1.5129456397865098, 1.3417755535187668, 0.9057371921790672, -1.5001666542024894, 0.3458141064576149, 1.222279890924978, -0.41622873727352183, -0.8846881772666522, -0.35605416020310354, -0.6419148477283759, 0.9051561676806565, -1.6930447093009757, -0.9180096162346079, 0.28194389446407864, 1.0017313246567843, -0.2298500562008022, 1.8480917913044526, 2.1980361050107926, -0.09148567542791172, -0.12960772427429806, -1.4748832760539183, 1.1171064778580306, 0.5827342634065892, 1.1783462793564192, 0.36200444115980035, 0.28137730200079264, -2.437301096806179, -0.24251681652117327, -0.6081272789141458, -1.084554613289938, 0.05837310105696938, 0.003579344292560314, 1.3210379511253962, -1.2580698708268192, -0.27478821420354843, 0.409391690178352, -0.8991564367943773, 0.6486431846650289, -1.1409382097468344, 0.7638663088212319, 0.7933973673049735, 0.7219394377508439, 1.3147785583015248, -1.3273806268361472, -0.24989786346346834, 0.9586669489470826, 0.5806458566485202, 1.0386949783508659, 0.762317070577101, 0.23776522502450115, 1.3594829188747073, 1.2568344585617635], 1, SplittableRandoms.SplittableRandom(0x13da141ed7d2b995, 0x0a8f11cb2c231117), (swap_acceptance_pr = GroupBy: Tuple{Int64, Int64} =&gt; OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}
,), 3), Pigeons.Replica{Vector{Float64}, NamedTuple{(:swap_acceptance_pr,), Tuple{OnlineStatsBase.GroupBy{Tuple{Int64, Int64}, Number, OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}}}}}([-0.15717225977783528, -1.075998424031663, 0.797915712941845, 0.8336341727439529, 0.9239354384022596, 0.820914939446305, 1.6758780703925977, 0.43623897134607464, 0.8616312900563976, 0.24390757932149662, -0.7363158178473681, -0.2938725400938, -0.15342752322541925, -1.0082290059225336, -0.3156683328549641, 1.9367578876614435, -0.5202070909386812, 0.03743343800135287, -1.491672535870992, 0.809318758032549, 0.14026928273942035, -0.05148585268286623, -1.191476021960653, 1.3441451097749222, -0.31856683881542913, -2.2972540311949676, -1.9296605279735666, 0.9044119541450516, -0.752371976121347, 0.806008466217381, 1.522669563453691, -0.4379244488526444, 0.16071494276273599, 1.6307376411250258, 0.5107363066295513, 0.6728007652053365, -0.7481849381430644, -0.4309452624118714, 0.7614779152525172, -1.1243126006166393, -0.7055440219468647, -0.28063085854825126, -0.25235036136164546, 1.3491856089126784, 0.29842030586849705, -0.9146398854245299, -1.678099937923178, 0.12785293095803604, -0.7403088717884146, -0.3304361553915003, -0.19560637482996726, 0.3261012102452427, 1.5003769705330505, -2.543216135738465, -0.32783823003450274, 0.5350879119145323, 1.3867566088049947, -1.144650235563821, 0.4305110166929776, -1.1629171235724125, 1.368288306861411, -0.2578291731190783, 1.3081511695914307, 1.398016361116708, -0.6487697009874538, 0.10103318019672387, -1.4420454755607357, 0.06762216811938965, -0.40368406007606966, -0.07860273001382191, 0.8879998304068722, 1.21968108086064, 0.537510967230123, 0.379136664687289, 0.3711725964011521, 0.6776015545010127, 1.0640542580103358, -1.0458020823827536, 0.1772355453666609, 0.8801871249358184, 1.2368525960493417, -0.3041124289374738, -0.39733866123495765, -0.41893348306395667, 0.4214626456640287, -1.6168463694172066, 1.1014220152257108, 0.8075458994843151, -1.2641831033368574, 0.6240081432156234, 0.8560106001445622, -1.49570477772377, -1.3930058185172673, 1.0567322919150277, 0.1971902282760705, 1.049621242776464, -1.6709493129551576, -0.3182633790448635, 0.501865897813347, -0.38722925974906874], 2, SplittableRandoms.SplittableRandom(0xcdf8f8f4a2510ddf, 0x7bc5b595c138f5b5), (swap_acceptance_pr = GroupBy: Tuple{Int64, Int64} =&gt; OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}
,), 7), Pigeons.Replica{Vector{Float64}, NamedTuple{(:swap_acceptance_pr,), Tuple{OnlineStatsBase.GroupBy{Tuple{Int64, Int64}, Number, OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}}}}}([0.561395322969012, 0.6841832686188324, -0.38289687839457165, 0.48862712638847816, -0.08428339657908951, -0.27395123274820443, -1.2736001982890324, 1.39007162165417, -0.1915256414236019, -0.6707411455199436, 0.8967632992427401, -0.023118383710419743, -0.12437090412577631, -0.7477330886300348, 1.628774523147067, -0.11267905157760963, 0.4226798715299402, 0.2614405737621158, -0.08445945352413277, 0.0024560910767429307, 0.7195991449148766, 0.5398439244260796, 0.2581768345257548, 0.7313949962834286, 0.8154415010794074, 0.537877295148474, -0.8857884232997508, 1.3887100552477358, 0.23099738306497186, 0.11408177341442166, 0.013883566177851943, -0.021737733879692477, 0.49651978511615563, -0.39676622026838776, -0.07935933726353338, 0.4064540277048335, 0.2881972214491651, 0.06477907920861141, 0.3663823729098087, -0.11168195197301577, 0.2778572885363074, -0.614337605232322, -0.4403554627552119, -0.3787550565579195, -0.1288596653106636, 1.6450680380819758, -1.5805521161942475, 0.255779746040193, 1.1165709908835184, 0.027120128264752113, -0.05828935101199512, -0.49432681458912436, 0.2419965989020453, -0.13114487076627362, -0.0871736168053152, 1.1791197161610387, -0.6103273227143438, 0.2789479176456546, -0.15922061630698806, -1.0793371998630976, -0.15316579149603102, -0.15931411780432994, -0.3666914631921302, -0.07513400627056162, 0.7269260431686843, -0.7785921156197527, 0.30257194983103514, -0.9310273384514357, -0.2600893720183155, 0.4242293613724294, 0.646484668577294, -0.22578596605432805, -0.2422175290306493, -0.4850088157154867, -0.8360856378351357, 0.4616316256367286, -0.6179702020231017, -0.4202811826620784, 0.07752859366910439, 2.14712553709719, 0.12056851356168309, -0.3987015359772581, 1.6506709558247927, -0.3525517787013211, 0.2359508866764569, 0.386046634380227, -0.032930481022421534, -0.1771148283584259, -0.537018012422071, 1.443478679137646, -0.7178084293278465, 0.3021108156368026, 0.3534009665473283, 0.35694089997638107, 0.3281764859961207, 0.5292008466196508, 0.1424229550024528, -0.2596482473809852, 0.10272552112868133, -0.8658958800840604], 3, SplittableRandoms.SplittableRandom(0x6a62932be235e9fa, 0xaabf13ae126f9159), (swap_acceptance_pr = GroupBy: Tuple{Int64, Int64} =&gt; OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}
,), 1), Pigeons.Replica{Vector{Float64}, NamedTuple{(:swap_acceptance_pr,), Tuple{OnlineStatsBase.GroupBy{Tuple{Int64, Int64}, Number, OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}}}}}([0.3025292014113767, 0.9563190169079584, -0.011608195008035968, -0.0426374000189312, 0.17397164000778897, 0.5830872524285542, 0.33056044778079674, -0.22462785194652155, 0.43246084797614387, 1.8879628294027344, 0.09358852413350793, 0.38883664902357795, 0.513433979240949, -1.3860056239587497, 0.5026908099219257, 0.7330939409440406, 0.667173458228023, -0.1511744877214114, 0.26788776991098184, 0.5058010534821094, 0.2773122382267906, -0.20830916944579492, -0.9131523569748495, 1.3238555123108255, -0.14550261656983426, 0.6874137675946304, -0.5144409968010282, -1.0093737443967838, 0.3550201310397387, -0.8218692567667772, 0.3940073531577863, 0.8555197214969302, 0.11256479853390022, 0.5578967518342213, -0.4095294607108461, 0.7120320750656277, -0.2636949915632124, -0.47153497746282574, 0.3983788965440976, -0.8765872378632421, 0.2592884036635957, -0.21856771448848092, -1.0620898353777923, -0.07222252702556985, -0.7574111147764055, -1.6455955025388946, -1.1221336492606808, 0.47427729376525557, -0.29044383412304486, 0.8086758248314209, -0.32695729314163624, -0.7084544318084018, -1.5580229171898223, 7.231471496668182e-6, -0.21520726854015987, 0.23358306658922193, -0.20894644676258936, 0.6173872551903771, -0.6769233815985075, -1.4785209103603267, 0.07449571678403939, -0.2382369295337112, -0.28723425798493246, -1.1771169976701288, 0.34748363521790365, -0.44745605587767195, -0.5875829780843052, 0.6418123979737848, 0.4620543869124963, -0.22428487998244043, -1.0535009656170358, 0.4490938632085193, -0.05425212758702194, -0.3937406872815786, 0.25550621680884195, 0.5630864736240523, -0.5933971405202363, 0.35547705698076987, -0.11011642532154338, -0.23449422579167567, -0.21407869983398498, 0.0665216094703743, -0.7269752504885243, 0.4881012754384327, 0.27603298277982674, -0.4806788711549143, -1.4757901926214358, 0.09931614751085263, -0.0232698960831674, 0.5252634152719337, -0.6016282604876625, -1.2372142931402774, -0.42713917814566094, -0.0857679418673642, 1.4178242433123185, -0.18960184968517274, -0.2856480171909926, 0.11639606288013347, 1.2554990329288556, 0.09730625296148937], 4, SplittableRandoms.SplittableRandom(0xad4359717006e8bb, 0x37c7139d2a1f28fd), (swap_acceptance_pr = GroupBy: Tuple{Int64, Int64} =&gt; OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}
,), 9), Pigeons.Replica{Vector{Float64}, NamedTuple{(:swap_acceptance_pr,), Tuple{OnlineStatsBase.GroupBy{Tuple{Int64, Int64}, Number, OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}}}}}([0.639794852259862, -0.18718867863495448, -0.1628965005186881, 0.01026290057400225, -0.16561429044831974, 0.9310905865065799, -0.9343075971866566, -0.8218185456548446, -0.8622892357760576, -0.4335422881637582, -0.4786328721601972, 0.14718569550489147, -0.7320865567542478, 0.013902534632206616, 0.03359924484148021, 0.09916231686548325, -1.1901342465768634, -0.6270287792020673, -0.431415023125023, 0.27109896436755104, 1.1295404509038987, -0.28423051026229035, 0.8415717256239794, 0.28646525144078216, 0.46753927866565265, 0.6534227084561807, 0.2563969711124156, -0.17783247492582954, -0.4660561250927257, -0.1495869720952234, -0.318373743415294, 1.1122698057651363, 0.9974316681423091, 0.09544370879781484, 0.7730678995696708, -0.8555908384292056, -0.3768557588346364, 0.907780197612409, -0.26930659782427746, 0.6513267502591974, -0.2091491421686149, -0.8241892407066506, -0.07173011882292196, -0.16987579538970082, 0.1879938956052384, -0.9992098726989418, 0.465929304352523, -0.45394479236630214, 0.24426793888224177, 0.3213571775692531, 0.17160034134945862, 0.40868243996868403, 0.17149492795661603, -0.2791356744048669, -0.646280322470222, 0.17091059488309185, 0.40381920906636215, -0.6288621475530538, 1.5207366025549995, 0.9971538134087816, 0.19062959234935387, 0.17253392397406012, -0.5212321382138386, 0.3701341587322075, -0.23096956020353784, 0.5995648434528863, -0.09860309699925038, 0.6844352764224007, -0.6368682070212853, 0.33125126337171035, -0.15601182246092496, 1.0659848013946465, 0.2755404617409903, 0.09066178194211111, -0.904984407776428, 0.6423527626323261, 1.4031935785601264, -0.3228254748801125, -0.22237745893492705, -0.5300390689527974, -0.20026785383783555, -0.3338114283194497, -0.7290046854353723, -0.6417311050091062, 0.8198183992486934, 0.5989154664446998, 0.10465657054260337, 0.9792013779739746, -0.16655235037548963, 0.7854009136917633, 0.06877561968414293, -0.5479267452112954, -0.46909638972974915, 1.7711467880971714, 1.9842867472481003, -0.38454867270667803, 0.4418775800442734, 0.14014831491018284, 0.29383312709768383, -0.08601581396943711], 5, SplittableRandoms.SplittableRandom(0x7e4e84dd46e0b55f, 0x5939fc78146ec0e5), (swap_acceptance_pr = GroupBy: Tuple{Int64, Int64} =&gt; OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}
,), 6), Pigeons.Replica{Vector{Float64}, NamedTuple{(:swap_acceptance_pr,), Tuple{OnlineStatsBase.GroupBy{Tuple{Int64, Int64}, Number, OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}}}}}([0.78933852035337, -0.9907056607820164, -0.4139393115752511, -0.6597295221998752, 0.7083960573210745, -0.16567738317259298, 0.06220623304257297, -0.5424624816026198, -0.9847994979535144, 0.00892214632252621, 0.4238521237701931, 0.4063652452069826, -1.250138838485707, 0.5594400446545879, 0.49147682063572273, 0.206888342856426, -0.14261758277664177, 0.997903642647352, 0.21460822015038544, 0.8057749203442081, 0.5579150282150372, 0.47085471550300917, 0.20989933368513458, 0.7292941177672158, 0.266823420399031, 0.4818121405022106, 0.0547761877558327, -0.13558858607392257, 0.268664532580811, 0.024478446915324838, 0.8073771135563141, 0.5145660431456128, -0.2299330270751197, -0.5647049466240384, 0.35993378465758263, -0.014253970717920571, -0.8386915840694674, 0.07131112856504487, -0.28333666238405086, -0.2211201547381751, -0.8534984482697446, -0.30179298339828603, 0.26498131509926715, -1.5382519425487062, 0.7353629357560412, 0.12295560584299511, -0.3585336720098691, -0.1426593487582134, -0.36913652286369003, 0.09439311405196749, 0.5327239973710501, 1.6951361048259688, -0.29425203292671254, -0.34813759154178187, -0.4558000773727324, 0.8495628180465234, 0.28691738719735854, -0.6615434249263653, 0.10418974652506453, 0.22650614812400743, -0.6910535472374109, 0.5627942770114287, 0.17035781970011266, -0.22564956860940807, -0.18605086896601616, 0.339367388063127, -0.5329787400456903, -1.5698894219479773, -0.05352192121974916, 1.0779543047447704, -0.7132995234519938, 0.5083416011515691, 0.9615470393877622, -0.025709371685209974, 0.1349825320967208, 0.39988032500676735, 0.013478553094585193, -0.72129286099169, 0.22654034396919856, 0.788079860254355, -0.2862812056639229, 0.7533445912656768, -0.037754687231375206, -0.5033444776255418, -0.22264832879788607, -0.35629659176319906, -0.554743549880562, -0.3517312492516747, -0.006048057016781938, -0.03836129361549087, -0.6450779417079918, 0.7991517660816858, -0.8120022384612704, 0.34415727758202735, -0.1683047816236359, 0.36204747472457205, 0.1527100907526989, -0.37574406771528246, -0.43311441597113853, -0.9039109102646734], 6, SplittableRandoms.SplittableRandom(0xea4d17d31916c28e, 0xa6de2bb231bf42e5), (swap_acceptance_pr = GroupBy: Tuple{Int64, Int64} =&gt; OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}
,), 8), Pigeons.Replica{Vector{Float64}, NamedTuple{(:swap_acceptance_pr,), Tuple{OnlineStatsBase.GroupBy{Tuple{Int64, Int64}, Number, OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}}}}}([-0.6445334884280306, 0.6001110375989597, -0.7808954873881707, -0.737725904168052, 0.1954146403081385, 0.10894068224389784, -0.17469678393173668, 0.014176810585592515, -0.09934162308547806, -0.5738431588311979, 1.0967970115150647, -0.19576016031360166, -0.1333392246369747, -0.09644191642126482, 0.4772432409010161, -0.29649839523812493, -0.7338365560772211, -0.45794438825569983, 0.4169014164747772, -0.455332015701079, -0.36250424475232285, -0.5087143412435986, -0.10751133269959767, 0.2566005513066682, 0.1610308895053551, -0.2590625875935467, -0.10268289387292846, -0.28930031954187824, 0.669060391803854, 0.20764129424726394, -0.4581078515693575, -0.15177692603514126, 0.274222281434493, -0.19758177059612841, 0.3169307826449207, 0.41471602872397006, -0.4368524132491714, -1.1081660951426182, 1.303322038715169, 0.28641470556462917, -0.30301036839821194, 0.1028631419387025, -0.08656236829775342, 0.20674834095434746, -0.18170250609318667, -0.1059888360591372, -0.29436453324849454, 0.37657096633431664, -0.34844389016808053, 0.2396695378135207, -0.39448791991257415, -0.16923042042814626, -0.16139025467889928, 0.6360962338098464, 0.4206268714888376, -0.03567810209743519, 0.14800806243235762, -0.24526764609504156, -0.01315632485007215, 0.3953477151083458, 0.9699213340150363, -0.45580695212627215, 0.7757055091408701, -0.9324318635640542, 0.08448265099210203, -0.15302364791558962, -0.17383725152286492, 0.5755396720471959, -0.08492357146585539, 0.5004531905394497, -0.09093779187890906, 0.47933238861030525, 0.809082008820424, -0.30192424418811986, 0.052183285223216566, -0.1849797045040679, 0.09591794936088167, -0.2869171566349869, -0.5802461105953103, -0.6295147723908677, -0.934687111439714, -1.6144268309667242, -0.27424144757791313, 0.10604172766667298, 0.5551707142345125, -0.1687306216802139, 0.7300535888579344, -0.3805760653587306, 0.05943710780112576, 0.23062559376407296, 0.4984478414937532, 0.4092754929713474, 0.549236500107082, 0.03760409278096552, 0.025266535825724766, -0.5124301292839547, 0.11111694694123138, -0.27921717958506054, -0.4233845843035944, 0.2999502002591391], 7, SplittableRandoms.SplittableRandom(0xb4d8200b58474ec2, 0xd318c34cf03eed71), (swap_acceptance_pr = GroupBy: Tuple{Int64, Int64} =&gt; OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}
,), 2), Pigeons.Replica{Vector{Float64}, NamedTuple{(:swap_acceptance_pr,), Tuple{OnlineStatsBase.GroupBy{Tuple{Int64, Int64}, Number, OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}}}}}([0.12179039095046415, 0.444091441650395, -0.30511964635730704, -0.032844173505357004, 0.25403159195902214, 0.13525610745148828, -1.0124176627257986, 0.1658705108753098, -0.01094378439326406, 0.08732780726195358, -0.37152413475691837, -0.8847673257866508, -0.49220493091132744, 0.6463051537171409, -0.08859549222259448, -0.031386073048527856, -0.23642918289618836, 0.4840421961250676, -0.29151371474533144, -0.062025993629906524, 0.20956232231017688, 0.03944950055393033, -0.7948527291125609, 0.5426390471833435, -0.08343272483447704, -0.1495439538581486, -0.38921928090068864, 0.06493204255765415, -0.0114951903072207, -0.49737351429868937, -0.16922158362606435, -0.2899807802457752, 0.12440453596564922, -0.3817985596683143, 0.009120531373456068, -0.44265418744345364, 0.5282588854794126, -1.132669401892297, -0.5550017940518559, -0.13472169882502621, -0.2850872612155003, 0.2398070909146493, 0.22908019796452359, 0.1483622716376841, -0.08370288319482808, -0.28861809135152305, -0.11427792605200039, -0.2114633898311953, 0.10650922536748453, 0.0034020276763837725, 0.5698804042464996, -0.10535576983315263, 0.20594181224144914, 0.07465376817150651, 0.26437431833495545, 0.40121404707313457, -0.03670952608218569, 0.6064229280097296, -0.38045945927526237, 0.8539914011606339, -0.2870062158880551, -0.049115045534157444, -0.05250411842567232, 0.8863784744416898, 0.1093850588988025, -0.08482092077173371, 0.2578225744951725, -0.09851183360005071, 0.17758840872817636, -0.14210511698820574, -0.9340735919416069, -0.47510394013530227, -0.10482322893016498, -0.19526907855623798, 0.08356426627071434, -0.7278622802714536, -0.25145214487121614, 0.6396157481733816, -0.4617395975960341, 0.2795853271363747, 0.18649810794265811, -0.00038364464821490535, 0.1177467362042823, 0.06363726354280737, 0.4291800234564071, 0.09471532022338289, -0.2832947790888828, 0.4794388063248261, -0.28369059530085194, -0.2402217180761543, 0.21209072863867665, 0.5757630865765178, -0.11003340596783155, 0.15935087520195254, -0.10882898563717823, 0.15496024737516415, -0.6051083290945121, -0.001624422090762298, 0.877194937868115, 0.5553817765900932], 8, SplittableRandoms.SplittableRandom(0x996a1899769a87cb, 0x55cfd67d68a1db2f), (swap_acceptance_pr = GroupBy: Tuple{Int64, Int64} =&gt; OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}
,), 5), Pigeons.Replica{Vector{Float64}, NamedTuple{(:swap_acceptance_pr,), Tuple{OnlineStatsBase.GroupBy{Tuple{Int64, Int64}, Number, OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}}}}}([-0.05272666130038536, -0.3254823140676331, 0.028373751784571934, -0.39442913472529184, -0.2542230643332873, 0.3674052575302897, -0.16605919381766363, -0.07937558266380211, 0.12838826709269743, 0.34853554095857825, 0.09160753707192473, -0.06971556074481002, 0.06539023205722447, -0.13281684831547638, -0.6589726464028292, 0.32115667807164455, -0.15613661127267692, 0.024328076608031483, -0.16162947666042615, -0.04015895590463043, -0.2571292147786077, -0.0821364216000047, 0.218695729792549, -0.5981778524702347, 0.2501861330454862, 0.05506971230260778, 0.10464746575392618, -0.28602936502857795, -0.2324186130557174, -0.2724319109726143, 0.5225587765982389, 0.016034722066812383, 0.17874488710213976, 0.632136690706899, -0.02910889512190741, 0.04847456620625143, 0.5430324603067225, -0.3484668496756229, 0.3063540787670875, -0.2054187428918381, 0.7817594875987834, -0.03669331499333809, -0.07892244097992829, 0.3719712187034864, 0.08117974153859633, 0.6866528034108297, 0.16576380639328026, 0.29248296161228093, -0.07078439076507571, 0.06894301919613707, -0.4315161884577028, 0.05931987287404986, 0.2866631006138441, 0.0652151207208134, 0.32894565308150975, 0.22892602046551747, -0.1383323591526991, -0.46772139537776636, -0.5085704469870324, 0.03555550531627836, 0.0022391703296895465, 0.5905178611199151, -0.19823542503070538, -0.08026477442750096, 0.008779546988895952, -0.269320229998473, -0.3104830589031032, -0.31252002847854604, -0.40565047359435913, -0.9776993125715472, -0.011466237930825587, 0.4160536616013738, -0.23205894009558106, -0.014792620154559328, -0.17476164871166133, -0.6566452738732469, 0.16254494962912872, -0.3737781882556833, -0.3536500392122062, -0.04292947421374593, -0.10522513738712017, 0.29374708138044037, 0.028981233735968528, 0.2391673524263153, -0.44499169364222313, -0.14340026802286487, -0.25347103053595543, 0.03055057793105521, -0.3493870157094795, 0.04673590948350518, 0.5256903699911252, 0.23014531845192868, -0.6562204063898605, -0.03388637147016912, -0.09141677266277257, 0.37393701230044174, 0.7396080482547239, -0.05416465212899083, 0.2403190436357105, -0.6193758845669092], 9, SplittableRandoms.SplittableRandom(0xd32d1089a998a7b4, 0x1f7f30b4a58a7045), (swap_acceptance_pr = GroupBy: Tuple{Int64, Int64} =&gt; OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}
,), 10), Pigeons.Replica{Vector{Float64}, NamedTuple{(:swap_acceptance_pr,), Tuple{OnlineStatsBase.GroupBy{Tuple{Int64, Int64}, Number, OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}}}}}([-0.27463240238014613, 0.5567857588659654, -0.33167846345211033, -0.3213033239339046, 0.17762372822792158, 0.30532653469174337, 0.20207053093181138, -0.1201004506491336, 0.032174263327495636, 0.19446041947457554, -0.041078360696050024, -0.2331094741732456, 0.7781280588780557, 0.450024117516755, 0.190180020539954, -0.4350249193364494, 0.24770328652516724, -0.0011376206570725064, -0.07988526064100766, -0.22713212478531486, -0.38781082489609653, 0.01287468392214968, 0.18838194989277982, -0.2136557505775217, -0.44171528539663035, -0.19278318575483716, 0.2900818551578693, 0.17955040838072714, -0.30903068130120254, 0.1314962995259901, -0.16624949631446384, 0.384709840805364, 0.33146798214523726, -0.025052243018315087, -0.2378420520863294, 0.5323440326889416, 0.020535753936601356, -0.07937441863461468, -0.13242369274731547, -0.3569768244721419, 0.22609598145866164, -0.3720696184909499, -0.12026176748849951, 0.1962082786968368, 0.2161052462659943, 0.5193695557112756, 0.06839954138092276, 0.0024102163636948518, -0.13609008569848824, -0.28033587103833196, -0.4208273997990945, 0.17585621570876495, 0.1501017207170228, -0.38627249498806643, -0.14772562649798526, 0.3613729390735646, 0.23077919176156234, 0.5721784040446631, 0.4472977108245198, 0.014879113262338805, 0.2801492502130375, 0.055004762579634624, 0.20343401246630075, 0.02210789017652492, 0.0448812065627899, -0.417817213040002, -0.3961470246843616, 0.11460645214772693, 0.0927630671806522, 0.19223493194481595, 0.3048568997440401, 0.10417742904957875, -0.007422866815735631, 0.2279523341345074, -0.020701431965075078, 0.27445321345698714, -0.03783062815098764, 0.03721062396685367, 0.10303307829193413, 0.005074540581844788, 0.21695827219454095, -0.08435191455012873, -0.1595834650257702, 0.05102846041034128, 0.1622954843241808, 0.04746901593669269, 0.22026004107978409, 0.006180787751601004, 0.0451774631661427, 0.497100382474617, -0.621327494511111, 0.20607270490713248, -0.4325999225320385, -0.5482518762388701, -0.11306109866601019, -0.2185527039518904, 0.050673875148306825, -0.4864444740871507, -0.4688814738866385, 0.19328637307681998], 10, SplittableRandoms.SplittableRandom(0xb52f4858d9c0ee55, 0x5c118b1e77224581), (swap_acceptance_pr = GroupBy: Tuple{Int64, Int64} =&gt; OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}
,), 4)], Pigeons.Shared{Pigeons.Iterators, Pigeons.NonReversiblePT{Pigeons.ScaledPrecisionNormalPath, Pigeons.Schedule, Vector{Distributions.FullNormal}, Pigeons.DEO}, Pigeons.ToyExplorer}(Pigeons.Iterators(10, 0), NonReversiblePT(Pigeons.ScaledPrecisionNormalPath(1.0, 10.0, 100), Pigeons.Schedule([0.0, 0.03162353349967015, 0.07652375310859821, 0.13117348918147062, 0.20330680010989594, 0.2933404416432117, 0.41294557523786446, 0.5637462414121358, 0.7571067504972553, 1.0])), Pigeons.ToyExplorer()), nothing, (swap_acceptance_pr = GroupBy: Tuple{Int64, Int64} =&gt; OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}
├─ (2, 3)=&gt;OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.221597
│  └─ OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.221597
├─ (1, 2)=&gt;OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.192939
│  └─ OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.192939
├─ (3, 4)=&gt;OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.18446
│  └─ OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.18446
├─ (4, 5)=&gt;OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.200738
│  └─ OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.200738
├─ (5, 6)=&gt;OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.204472
│  └─ OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.204472
├─ (6, 7)=&gt;OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.233086
│  └─ OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.233086
├─ (7, 8)=&gt;OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.208533
│  └─ OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.208533
├─ (8, 9)=&gt;OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.207609
│  └─ OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.207609
└─ (9, 10)=&gt;OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.188372
   └─ OnlineStatsBase.Mean{Float64, OnlineStatsBase.EqualWeight}: n=512 | value=0.188372
,)</code></pre><h2 id="Automatic-correctness-checks"><a class="docs-heading-anchor" href="#Automatic-correctness-checks">Automatic correctness checks</a><a id="Automatic-correctness-checks-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-correctness-checks" title="Permalink"></a></h2><p>It is notoriously difficult to implement correct parallel/distributed algorithms.  One strategy we use to address this is to guarantee that the code will output  precisely the same output no matter how many threads/machines are used.  We describe how this is done under the hood in the page <a href="distributed.html">Distributed PT</a>. </p><p>In practice, how is this useful? Let us say you developed a new target and you would like to make sure that it works correctly in a multi-threaded environment. To do so, you can  just add a flag to indicate to &quot;check&quot; one of the PT rounds as follows:</p><pre><code class="language-julia hljs">pigeons(target = toy_mvn_target(100), checked_round = 3)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PT(&quot;/home/runner/work/Pigeons.jl/Pigeons.jl/docs/build/results/all/2023-01-15-03-51-42-ywgSOgcB&quot;)</code></pre><p>The above line does the following: the PT algorithm will pause at the end of round 3, spawn  a separate process with only one thread in it, run 3 rounds of PT with the same  <a href="reference/#Pigeons.Inputs"><code>Inputs</code></a> object in it, and verify that the checkpoints of the single-threaded run  is identical to   the one that ran in the main process. If not, an error will be raised with some  information on where the discrepancy comes from.  Try to pick the checked round to be small enough that it does not dominate the running time  (since it runs in single-threaded, single-process mode), but big enough to achieve  the same code coverage as the full algorithm. Setting it to zero (or omitting the argument),  disable this functionality.</p><p>Did the code above actually used many threads? This depends on the value of <code>Threads.nthreads()</code>. Julia currently does not allow you to change this value at  runtime, so for convenience we provide the following way to run the job in a  child process with a set number of Julia threads:</p><pre><code class="language-julia hljs">pt_result = pigeons(target = toy_mvn_target(100), checked_round = 3, on = ChildProcess(n_threads = 4))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Result{PT}(&quot;/home/runner/work/Pigeons.jl/Pigeons.jl/docs/build/results/all/2023-01-15-03-52-14-La7FdFuZ&quot;)</code></pre><p>Notice that this time, instead of returning a <a href="reference/#Pigeons.PT"><code>PT</code></a> struct, this time we obtain  a <a href="reference/#Pigeons.Result"><code>Result</code></a>, which only holds the path where the checkpoints can be found.  If you would like to load a result in memory, use:</p><pre><code class="language-julia hljs">pt = load(pt_result)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PT(&quot;/home/runner/work/Pigeons.jl/Pigeons.jl/docs/build/results/all/2023-01-15-03-53-18-7TOi3GoY&quot;)</code></pre><p>In this case, since the model is built-in, the check passed successfully as expected. But what  if you had a third-party target distribution that is not multi-threaded friendly?  I.e. it may write in global variables or  other non-thread safe construct. Then you can probably still  use your thread-naive  target over MPI <em>processes</em>.  For example, if the thread-unsafety comes from the use of global variables, then each  process will have its own copy of the global variables. </p><p>We described how MPI can be used in the next two sections.</p><h2 id="Running-MPI-locally"><a class="docs-heading-anchor" href="#Running-MPI-locally">Running MPI locally</a><a id="Running-MPI-locally-1"></a><a class="docs-heading-anchor-permalink" href="#Running-MPI-locally" title="Permalink"></a></h2><p>To run MPI locally on one machine, using 4 MPI processes and 1 thread per process use:</p><pre><code class="language-julia hljs">pigeons(
    target = toy_mvn_target(100),
    checked_round = 3,
    on = ChildProcess(
            n_local_mpi_processes = 4,
            n_threads = 1))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Result{PT}(&quot;/home/runner/work/Pigeons.jl/Pigeons.jl/docs/build/results/all/2023-01-15-03-53-18-FNQqMVu6&quot;)</code></pre><p>Note that if <code>n_local_mpi_processes</code> exceeds the number of cores, performance  will steeply degrade (in contrast to threads, for which performance degrades  much more gracefully when the number of threads exceeds the number of cores). </p><h2 id="Running-MPI-on-a-cluster"><a class="docs-heading-anchor" href="#Running-MPI-on-a-cluster">Running MPI on a cluster</a><a id="Running-MPI-on-a-cluster-1"></a><a class="docs-heading-anchor-permalink" href="#Running-MPI-on-a-cluster" title="Permalink"></a></h2><div class="admonition is-info"><header class="admonition-header">The magic of distributed Parallel Tempering</header><div class="admonition-body"><p>If the dimensionality of the state space is large, you may worry that  the time to transmit states over the network would dominate the running time.  Remarkably, the size of the messages transmitted in the inner loop of our  algorithm does <strong>not</strong> depend on the state space. In a nutshell, the  machines only need to transmit the value of log density ratios (a single float).  See <a href="https://rss.onlinelibrary.wiley.com/doi/10.1111/rssb.12464">Algorithm 5 in Syed et al., 2021</a> for details.</p></div></div><p>MPI is typically available via a cluster scheduling system. At the time of  writing, only <code>PBS PRO</code> is supported, but more will be added. </p><p>Follow these instructions to run MPI over several machines:</p><ol><li>In the cluster login node, follow the <a href="#Installing-Pigeons">installation instruction as above</a>. </li><li>Start Julia in the login node, and perform a one-time setup by calling <a href="reference/#Pigeons.setup_mpi-Tuple{}"><code>setup_mpi()</code></a>.</li><li>Still in the Julia REPL running in the login node, use:</li></ol><pre><code class="nohighlight hljs">pigeons(
    target = toy_mvn_target(100), 
    checked_round = 3, 
    n_chains = 1000,
    on = MPI(
        n_mpi_processes = 1000,
        n_threads = 1))</code></pre><p>This will start a distributed PT algorithm with 1000 chains on 1000 MPI processes, each using one thread.</p><h2 id="Specification-of-general-models"><a class="docs-heading-anchor" href="#Specification-of-general-models">Specification of general models</a><a id="Specification-of-general-models-1"></a><a class="docs-heading-anchor-permalink" href="#Specification-of-general-models" title="Permalink"></a></h2><p>The most general way to invoke Pigeons is by specifying two ingredients: a sequence of distributions,  <span>$\pi_1, \pi_2, \dots, \pi_N$</span>, and for each <span>$\pi_i$</span>, a <span>$\pi_i$</span>-invariant Markov transition kernel. Typically, <span>$\pi_1$</span> is a distribution from which we can sample i.i.d. (e.g. the prior, or a variational  approximation), while the last distribution coincides with the distribution of interest,  <span>$\pi_N = \pi$</span>.  This sequence of distributions is specified using the informal interface <a href="interfaces/#Pigeons.log_potentials"><code>log_potentials</code></a>. </p><div class="admonition is-warning"><header class="admonition-header">TODO</header><div class="admonition-body"><p>Add instructions for Markov transition kernels, and example code.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="pt/">Parallel Tempering (PT) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Sunday 15 January 2023 03:56">Sunday 15 January 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
